<!DOCTYPE html>
<html lang="en">
  <head>
    <title>  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset='utf-8'>
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>
    <a title="  Reference"></a>
    <header>
      <div class="content-wrapper">
        <p><a href="index.html"> Docs</a> (100% documented)</p>
        <div class="header-right">
          <form role="search" action="search.json">
            <input type="text" placeholder="Search documentation" data-typeahead>
          </form>
        </div>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="index.html"> Reference</a>
        <img id="carat" src="img/carat.png" alt=""/>
          Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a href="Classes.html">Classes</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/Session.html">Session</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Enums.html">Enumerations</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Enums/Body.html">Body</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/Method.html">Method</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/QueryValue.html">QueryValue</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Extensions.html">Extensions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Extensions/Array.html">Array</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/Bool.html">Bool</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/Data.html">Data</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/Int.html">Int</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/Optional.html">Optional</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/String.html">String</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/URLComponents.html">URLComponents</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/URLComponents/Error.html">– Error</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/URLRequest.html">URLRequest</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/URLSession.html">URLSession</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Protocols.html">Protocols</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Protocols/QueryParam.html">QueryParam</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/RequestInterceptor.html">RequestInterceptor</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/ResponseInterceptor.html">ResponseInterceptor</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Structs.html">Structures</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Structs/CompositeInterceptor.html">CompositeInterceptor</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/MultipartFormData.html">MultipartFormData</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/MultipartFormData/Error.html">– Error</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Path.html">Path</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/Request.html">Request</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/SessionConfiguration.html">SessionConfiguration</a>
              </li>
              <li class="nav-group-task">
                <a href="Structs/URLDataResponse.html">URLDataResponse</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Typealiases.html">Type Aliases</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Typealiases.html#/s:10SimpleHTTP11Interceptora">Interceptor</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            
            <h1 id='simplehttp' class='heading'>SimpleHTTP</h1>

<p><img src="https://img.shields.io/badge/Swift-5.5%2B-orange?logo=swift&logoColor=white" alt="swift">
<img src="https://img.shields.io/badge/Platforms-iOS%20%7C%20macOS-lightgrey" alt="platforms">
<img src="https://github.com/pjechris/SimpleHTTP/actions/workflows/test.yml/badge.svg" alt="tests"></p>

<p><a href="https://twitter.com/pjechris"><img src="https://img.shields.io/badge/twitter-pjechris-1DA1F2?logo=twitter&logoColor=white" alt="twitter"></a>
<a href="https://pjechris.github.io/SimpleHTTP/"><img src="https://img.shields.io/badge/read%20the%20doc-8CA1AF?logo=readthedocs&logoColor=white" alt="doc"></a></p>

<p>Make HTTP API calls easier. Built on top of URLSession.</p>
<h2 id='installation' class='heading'>Installation</h2>

<p>Use Swift Package Manager to install the library:</p>
<pre class="highlight swift"><code><span class="nv">dependencies</span><span class="p">:</span> <span class="p">[</span>
  <span class="o">.</span><span class="nf">package</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="s">"https://github.com/pjechris/SimpleHTTP"</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="s">"0.4.0"</span><span class="p">),</span>
<span class="p">]</span>
</code></pre>

<p>The package come with 2 modules:</p>

<ul>
<li><code>SimpleHTTP</code> which bring the full framework API described in this README</li>
<li><code>SimpleHTTPFoundation</code> which only bring a few addition to Foundation API. See this <a href="https://swiftunwrap.com/article/designing-http-framework-foundation/">article</a> or <a href="https://pjechris.github.io/SimpleHTTP/">API doc</a> to have a glimpse of what is provided.</li>
</ul>
<h2 id='basic-usage' class='heading'>Basic Usage</h2>
<h3 id='building-a-request' class='heading'>Building a request</h3>

<p>You make requests by creating <a href="https://pjechris.github.io/SimpleHTTP/Structs/Request.html"><code><a href="Structs/Request.html">Request</a></code></a> objects. You can either create them manually or provide static definition by extending <code><a href="Structs/Request.html">Request</a></code>:</p>
<pre class="highlight swift"><code><span class="kd">extension</span> <span class="kt">Request</span> <span class="p">{</span>
  <span class="kd">static</span> <span class="k">let</span> <span class="nv">func</span> <span class="nf">login</span><span class="p">(</span><span class="n">_</span> <span class="nv">body</span><span class="p">:</span> <span class="kt">UserBody</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Request</span><span class="o">&lt;</span><span class="kt">UserResponse</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="o">.</span><span class="nf">post</span><span class="p">(</span><span class="s">"login"</span><span class="p">,</span> <span class="nv">body</span><span class="p">:</span> <span class="n">body</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>This defines a <code>Request.login(_:)</code> method which create a request targeting &ldquo;login&rdquo; path by sending a <code>UserBody</code> and expecting a <code>UserResponse</code> as response.</p>
<h3 id='sending-a-request' class='heading'>Sending a request</h3>

<p>You can use your request along <code>URLSession</code> by converting it into a <code>URLRequest</code> by calling <code>request.toURLRequest(encoder:relativeTo:accepting)</code>.</p>

<p>You can also use a <code><a href="Classes/Session.html">Session</a></code> object. <a href="https://pjechris.github.io/SimpleHTTP/Classes/Session.html"><code><a href="Classes/Session.html">Session</a></code></a> is somewhat similar to <code>URLSession</code> but providing additional functionalities:</p>

<ul>
<li>encoder/decoder for all requests</li>
<li>error handling</li>
<li>ability to <a href="#interceptor">intercept</a> requests</li>
</ul>
<pre class="highlight swift"><code>
<span class="k">let</span> <span class="nv">session</span> <span class="o">=</span> <span class="kt">Session</span><span class="p">(</span>
  <span class="nv">baseURL</span><span class="p">:</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://github.com"</span><span class="p">)</span><span class="o">!</span><span class="p">,</span>
  <span class="nv">encoder</span><span class="p">:</span> <span class="kt">JSONEncoder</span><span class="p">(),</span>
  <span class="nv">decoder</span><span class="p">:</span> <span class="kt">JSONDecoder</span><span class="p">()</span>
<span class="p">)</span>

<span class="k">try</span> <span class="n">await</span> <span class="n">session</span><span class="o">.</span><span class="nf">response</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="o">.</span><span class="nf">login</span><span class="p">(</span><span class="kt">UserBody</span><span class="p">(</span><span class="nv">username</span><span class="p">:</span> <span class="s">"pjechris"</span><span class="p">,</span> <span class="nv">password</span><span class="p">:</span> <span class="s">"MyPassword"</span><span class="p">)))</span>

</code></pre>

<p>A few words about Session:</p>

<ul>
<li><code>baseURL</code> will be prepended to all call paths</li>
<li>You can skip encoder and decoder if you use JSON</li>
<li>You can provide a custom <code>URLSession</code> instance if ever needed</li>
</ul>
<h2 id='send-a-body' class='heading'>Send a body</h2>

<p>Request support two body types:</p>

<ul>
<li><a href="#encodable">Encodable</a></li>
<li><a href="#multipart">Multipart</a></li>
</ul>
<h3 id='encodable' class='heading'>Encodable</h3>

<p>To send an Encodable object just set it as your Request body:</p>
<pre class="highlight swift"><code><span class="kd">struct</span> <span class="kt">UserBody</span><span class="p">:</span> <span class="kt">Encodable</span> <span class="p">{}</span>

<span class="kd">extension</span> <span class="kt">Request</span> <span class="p">{</span>
  <span class="kd">static</span> <span class="kd">func</span> <span class="nf">login</span><span class="p">(</span><span class="n">_</span> <span class="nv">body</span><span class="p">:</span> <span class="kt">UserBody</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Request</span><span class="o">&lt;</span><span class="kt">LoginResponse</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="o">.</span><span class="nf">post</span><span class="p">(</span><span class="s">"login"</span><span class="p">,</span> <span class="nv">body</span><span class="p">:</span> <span class="n">body</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<h3 id='multipart' class='heading'>Multipart</h3>

<p>You can create <a href="https://pjechris.github.io/SimpleHTTP/Structs/MultipartFormData.html">multipart</a> content from two kind of content</p>

<ul>
<li>From a disk file (using a <code>URL</code>)</li>
<li>From raw content (using <code>Data</code>)</li>
</ul>

<p>First example show how to create a request sending an audio file as request body:</p>
<pre class="highlight swift"><code><span class="kd">extension</span> <span class="kt">Request</span> <span class="p">{</span>
  <span class="kd">static</span> <span class="kd">func</span> <span class="nf">send</span><span class="p">(</span><span class="nv">audioFile</span><span class="p">:</span> <span class="kt">URL</span><span class="p">)</span> <span class="k">throws</span> <span class="o">-&gt;</span> <span class="kt">Request</span><span class="o">&lt;</span><span class="kt">SendAudioResponse</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">multipart</span> <span class="o">=</span> <span class="kt">MultipartFormData</span><span class="p">()</span>

    <span class="k">try</span> <span class="n">multipart</span><span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">audioFile</span><span class="p">,</span> <span class="nv">name</span><span class="p">:</span> <span class="s">"define_your_name"</span><span class="p">)</span>

    <span class="k">return</span> <span class="o">.</span><span class="nf">post</span><span class="p">(</span><span class="s">"v1/sendAudio"</span><span class="p">,</span> <span class="nv">body</span><span class="p">:</span> <span class="n">multipart</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>Second example show same request but this time audio file is just some raw unknown data:</p>
<pre class="highlight swift"><code>  <span class="kd">static</span> <span class="kd">func</span> <span class="nf">send</span><span class="p">(</span><span class="nv">audioFile</span><span class="p">:</span> <span class="kt">Data</span><span class="p">)</span> <span class="k">throws</span> <span class="o">-&gt;</span> <span class="kt">Request</span><span class="o">&lt;</span><span class="kt">SendAudioResponse</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">multipart</span> <span class="o">=</span> <span class="kt">MultipartFormData</span><span class="p">()</span>

    <span class="k">try</span> <span class="n">multipart</span><span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="n">audioFile</span><span class="p">,</span> <span class="nv">name</span><span class="p">:</span> <span class="s">"your_name"</span><span class="p">,</span> <span class="nv">mimeType</span><span class="p">:</span> <span class="s">"audioFile_mimeType"</span><span class="p">)</span>

    <span class="k">return</span> <span class="o">.</span><span class="nf">post</span><span class="p">(</span><span class="s">"v1/sendAudio"</span><span class="p">,</span> <span class="nv">body</span><span class="p">:</span> <span class="n">multipart</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>Note you can add multiple contents inside a <code><a href="Structs/MultipartFormData.html">MultipartFormData</a></code>. For instance here we send both a audio file and an image:</p>
<pre class="highlight swift"><code><span class="kd">extension</span> <span class="kt">Request</span> <span class="p">{</span>
  <span class="kd">static</span> <span class="kd">func</span> <span class="nf">send</span><span class="p">(</span><span class="nv">audio</span><span class="p">:</span> <span class="kt">URL</span><span class="p">,</span> <span class="nv">image</span><span class="p">:</span> <span class="kt">Data</span><span class="p">)</span> <span class="k">throws</span> <span class="o">-&gt;</span> <span class="kt">Request</span><span class="o">&lt;</span><span class="kt">SendAudioImageResponse</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">var</span> <span class="nv">multipart</span> <span class="o">=</span> <span class="kt">MultipartFormData</span><span class="p">()</span>

    <span class="k">try</span> <span class="n">multipart</span><span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">audio</span><span class="p">,</span> <span class="nv">name</span><span class="p">:</span> <span class="s">"define_your_name"</span><span class="p">)</span>
    <span class="k">try</span> <span class="n">multipart</span><span class="o">.</span><span class="nf">add</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="n">image</span><span class="p">,</span> <span class="nv">name</span><span class="p">:</span> <span class="s">"your_name"</span><span class="p">,</span> <span class="nv">mimeType</span><span class="p">:</span> <span class="s">"image_mimeType"</span><span class="p">)</span>

    <span class="k">return</span> <span class="o">.</span><span class="nf">post</span><span class="p">(</span><span class="s">"v1/send"</span><span class="p">,</span> <span class="nv">body</span><span class="p">:</span> <span class="n">multipart</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<h2 id='constant-paths' class='heading'>Constant paths</h2>

<p>You can declare constant paths if needed (refer to Path documentation to see more):</p>
<pre class="highlight swift"><code><span class="kd">extension</span> <span class="kt">Path</span> <span class="p">{</span>
  <span class="kd">static</span> <span class="k">let</span> <span class="nv">login</span><span class="p">:</span> <span class="kt">Path</span> <span class="o">=</span> <span class="s">"login"</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">Request</span> <span class="p">{</span>
  <span class="kd">static</span> <span class="k">let</span> <span class="nv">func</span> <span class="nf">login</span><span class="p">(</span><span class="n">_</span> <span class="nv">body</span><span class="p">:</span> <span class="kt">UserBody</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Request</span><span class="o">&lt;</span><span class="kt">UserResponse</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="o">.</span><span class="nf">post</span><span class="p">(</span><span class="o">.</span><span class="n">login</span><span class="p">,</span> <span class="nv">body</span><span class="p">:</span> <span class="n">body</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<h2 id='interceptor' class='heading'>Interceptor</h2>

<p>When using Session you can add automatic behavior to your requests/responses using <code><a href="Typealiases.html#/s:10SimpleHTTP11Interceptora">Interceptor</a></code> like authentication, logging, request retrying, etc&hellip;</p>
<h3 id='code-requestinterceptor-code' class='heading'><code><a href="Protocols/RequestInterceptor.html">RequestInterceptor</a></code></h3>

<p><a href="https://pjechris.github.io/SimpleHTTP/Protocols/RequestInterceptor.html"><code><a href="Protocols/RequestInterceptor.html">RequestInterceptor</a></code></a> allows to adapt and/or retry a request:</p>

<ul>
<li><code>adaptRequest</code> method is called before making a request allowing you to transform it adding headers, changing path, &hellip;</li>
<li><code>rescueRequestError</code> is called whenever the request fail. You&rsquo;ll have a chance to retry the request. This can be used to re-authenticate the user for instance</li>
</ul>
<h3 id='code-responseinterceptor-code' class='heading'><code><a href="Protocols/ResponseInterceptor.html">ResponseInterceptor</a></code></h3>

<p><a href="https://pjechris.github.io/SimpleHTTP/Protocols/ResponseInterceptor.html"><code><a href="Protocols/ResponseInterceptor.html">ResponseInterceptor</a></code></a> is dedicated to intercept and server responses:</p>

<ul>
<li><code>adaptResponse</code> change the server output</li>
<li><code>receivedResponse</code> notify about the server final response (a valid output or error)</li>
</ul>

          </section>
        </section>
        <section id="footer">
          <p>&copy; 2023 <a class="link" href="" target="_blank" rel="external noopener"></a>. All rights reserved. (Last updated: 2023-03-20)</p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external noopener">jazzy ♪♫ v0.14.3</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external noopener">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</html>
